<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve" xmlns:t="http://www.w3.org/1999/xhtml" xmlns:owl="http://www.odoo.com/owl">
    <t t-name="gas_station_cash.BlockingOverlay" owl="1">
        <div t-att-class="'gsc_overlay ' + (state.visible ? 'gsc_visible' : 'gsc_hidden')">
            
            <!-- ========== PROCESSING STATE ========== -->
            <t t-if="showProcessing">
                <div class="gsc_card gsc_processing">
                    <div class="gsc_spinner">‚è≥</div>
                    <h2><t t-esc="actionText"/></h2>
                    <p><t t-esc="messageText"/></p>
                </div>
            </t>
            
            <!-- ========== ERROR STATE (Glory Connection Error) ========== -->
            <t t-if="showError">
                <div class="gsc_card gsc_error_card">
                    <div class="gsc_error_icon">‚ö†Ô∏è</div>
                    <h2><t t-esc="actionText"/></h2>
                    <p class="gsc_error_message"><t t-esc="messageText"/></p>
                    <t t-if="subMessageText">
                        <p class="gsc_error_sub"><t t-esc="subMessageText"/></p>
                    </t>
                    <t t-if="state.showCloseButton">
                        <button class="gsc_btn gsc_btn_close" t-on-click="onCloseError">
                            Close
                        </button>
                    </t>
                </div>
            </t>
            
            <!-- ========== INSUFFICIENT RESERVE STATE ========== -->
            <t t-if="showInsufficientReserve">
                <div class="gsc_card gsc_insufficient_reserve">
                    <div class="gsc_warning_icon">‚ö†Ô∏è</div>
                    <h2>Insufficient Reserve</h2>
                    <p class="gsc_warning_message">Cash in machine is below required reserve amount.</p>
                    
                    <div class="gsc_reserve_info">
                        <div class="gsc_reserve_row">
                            <span class="gsc_reserve_label">Current Cash:</span>
                            <span class="gsc_reserve_value">‡∏ø<t t-esc="currentCashFormatted"/></span>
                        </div>
                        <div class="gsc_reserve_row">
                            <span class="gsc_reserve_label">Required Reserve:</span>
                            <span class="gsc_reserve_value">‡∏ø<t t-esc="requiredReserveFormatted"/></span>
                        </div>
                        <div class="gsc_reserve_row gsc_shortfall">
                            <span class="gsc_reserve_label">Shortfall:</span>
                            <span class="gsc_reserve_value">‡∏ø<t t-esc="shortfallFormatted"/></span>
                        </div>
                    </div>
                    
                    <p class="gsc_reserve_note">No cash was collected to Collection Box.</p>
                    
                    <button class="gsc_btn gsc_btn_close" t-on-click="onCloseInsufficientReserve">
                        Acknowledge
                    </button>
                </div>
            </t>
            
            <!-- ========== WIZARD STATE (Collection Box Replacement) ========== -->
            <t t-if="showWizard">
                <div class="gsc_wizard">
                    
                    <!-- Header -->
                    <div class="gsc_wizard_header">
                        <div class="gsc_header_icon">‚úÖ</div>
                        <h2>Collection Complete</h2>
                        <div class="gsc_amount">‡∏ø<t t-esc="collectedAmountFormatted"/></div>
                    </div>
                    
                    <!-- Progress Steps -->
                    <div class="gsc_steps">
                        <div t-att-class="'gsc_step ' + (wizard.currentStep >= 1 ? 'active' : '') + (wizard.currentStep > 1 ? ' done' : '')">
                            <span class="num">1</span>
                            <span class="label">Coins</span>
                        </div>
                        <div class="gsc_step_line" t-att-class="wizard.currentStep > 1 ? 'done' : ''"></div>
                        <div t-att-class="'gsc_step ' + (wizard.currentStep >= 2 ? 'active' : '') + (wizard.currentStep > 2 ? ' done' : '')">
                            <span class="num">2</span>
                            <span class="label">Notes</span>
                        </div>
                        <div class="gsc_step_line" t-att-class="wizard.currentStep > 2 ? 'done' : ''"></div>
                        <div t-att-class="'gsc_step ' + (wizard.currentStep >= 3 ? 'active' : '')">
                            <span class="num">3</span>
                            <span class="label">Done</span>
                        </div>
                    </div>
                    
                    <!-- Step Content -->
                    <div class="gsc_content">
                        
                        <!-- STEP 1: COINS -->
                        <t t-if="wizard.currentStep === 1">
                            <div class="gsc_step_card">
                                <div class="gsc_icon">ü™ô</div>
                                <h3>Coin Collection Box</h3>
                                
                                <!-- Coins breakdown -->
                                <t t-if="collectedCoins.length > 0">
                                    <div class="gsc_items">
                                        <t t-foreach="collectedCoins" t-as="c" t-key="c.fv">
                                            <span class="gsc_item">‡∏ø<t t-esc="c.value"/> √ó <t t-esc="c.qty"/></span>
                                        </t>
                                    </div>
                                </t>
                                
                                <!-- Sub-step: Unlock -->
                                <t t-if="wizard.subStep === 'unlock'">
                                    <p class="gsc_desc">Press the button to unlock the coin collection box.</p>
                                    <button class="gsc_btn primary" t-att-disabled="wizard.isLoading" t-on-click="onUnlockCoins">
                                        <t t-if="wizard.isLoading">‚è≥ Unlocking...</t>
                                        <t t-else="">üîì Unlock Coin Box</t>
                                    </button>
                                </t>
                                
                                <!-- Sub-step: Replace -->
                                <t t-if="wizard.subStep === 'replace'">
                                    <div class="gsc_instructions">
                                        <p><strong>Instructions:</strong></p>
                                        <ol>
                                            <li>Remove the full coin box</li>
                                            <li>Insert an empty coin box</li>
                                            <li>Close the compartment</li>
                                        </ol>
                                    </div>
                                    <button class="gsc_btn primary" t-att-disabled="wizard.isLoading" t-on-click="onLockCoins">
                                        <t t-if="wizard.isLoading">‚è≥ Locking...</t>
                                        <t t-else="">üîí Box Replaced - Lock</t>
                                    </button>
                                </t>
                            </div>
                        </t>
                        
                        <!-- STEP 2: NOTES -->
                        <t t-if="wizard.currentStep === 2">
                            <div class="gsc_step_card">
                                <div class="gsc_icon">üíµ</div>
                                <h3>Note Collection Box</h3>
                                
                                <!-- Notes breakdown -->
                                <t t-if="collectedNotes.length > 0">
                                    <div class="gsc_items">
                                        <t t-foreach="collectedNotes" t-as="n" t-key="n.fv">
                                            <span class="gsc_item">‡∏ø<t t-esc="n.value"/> √ó <t t-esc="n.qty"/></span>
                                        </t>
                                    </div>
                                </t>
                                
                                <!-- Sub-step: Unlock -->
                                <t t-if="wizard.subStep === 'unlock'">
                                    <p class="gsc_desc">Press the button to unlock the note collection box.</p>
                                    <button class="gsc_btn primary" t-att-disabled="wizard.isLoading" t-on-click="onUnlockNotes">
                                        <t t-if="wizard.isLoading">‚è≥ Unlocking...</t>
                                        <t t-else="">üîì Unlock Note Box</t>
                                    </button>
                                </t>
                                
                                <!-- Sub-step: Replace -->
                                <t t-if="wizard.subStep === 'replace'">
                                    <div class="gsc_instructions">
                                        <p><strong>Instructions:</strong></p>
                                        <ol>
                                            <li>Remove the full note box</li>
                                            <li>Insert an empty note box</li>
                                            <li>Close the compartment</li>
                                        </ol>
                                    </div>
                                    <button class="gsc_btn primary" t-att-disabled="wizard.isLoading" t-on-click="onLockNotes">
                                        <t t-if="wizard.isLoading">‚è≥ Locking...</t>
                                        <t t-else="">üîí Box Replaced - Lock</t>
                                    </button>
                                </t>
                            </div>
                        </t>
                        
                        <!-- STEP 3: DONE -->
                        <t t-if="wizard.currentStep === 3">
                            <div class="gsc_step_card gsc_done">
                                <div class="gsc_icon">üéâ</div>
                                <h3>All Done!</h3>
                                <p class="gsc_desc">Both collection boxes have been replaced successfully.</p>
                                
                                <div class="gsc_summary">
                                    <div class="gsc_summary_row">
                                        <span>ü™ô Coins</span>
                                        <span class="gsc_check">‚úÖ</span>
                                    </div>
                                    <div class="gsc_summary_row">
                                        <span>üíµ Notes</span>
                                        <span class="gsc_check">‚úÖ</span>
                                    </div>
                                </div>
                                
                                <button class="gsc_btn success" t-on-click="onFinish">
                                    ‚úì Finish
                                </button>
                            </div>
                        </t>
                        
                    </div>
                    
                    <!-- Wizard Error -->
                    <t t-if="wizard.errorMessage">
                        <div class="gsc_wizard_error">
                            ‚ö†Ô∏è <t t-esc="wizard.errorMessage"/>
                        </div>
                    </t>
                    
                    <!-- Skip -->
                    <t t-if="wizard.currentStep &lt; 3">
                        <div class="gsc_skip">
                            <button class="gsc_btn_link" t-on-click="onSkip">Skip and finish later</button>
                        </div>
                    </t>
                    
                </div>
            </t>
            
        </div>
    </t>
</templates>