<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve" xmlns:t="http://odoo.com/owl">

<t t-name="gas_station_cash.ExchangeCashScreen" owl="1">
  <div class="o_exchange_cash_screen">

    <!-- Step 1: Live Cash-In (using LiveCashInScreen component) -->
    <t t-if="state.step === 'counting'">
      <LiveCashInScreen
          liveAmount="state.liveAmount"
          busy="state.busy"
          onDone.bind="_onCashInDone"
          onCancel.bind="_onCashInCancel"
          onApiError.bind="_onCashInError"
          onStatusUpdate="props.onStatusUpdate"
      />
    </t>

    <!-- Step 2: Denomination Selection -->
    <t t-if="state.step === 'denominations'">
      <div class="exchange-denom-container">
        <div class="exchange-denom-card">
          <!-- Header -->
          <div class="exchange-denom-header">
            <div class="exchange-denom-icon">
              <i class="fa fa-exchange"></i>
            </div>
            <h2 class="exchange-denom-title">Select Denominations</h2>
            <p class="exchange-denom-subtitle">เลือกธนบัตร/เหรียญที่ต้องการแลก</p>
          </div>

          <!-- Amount Summary -->
          <div class="exchange-amount-summary">
            <div class="exchange-amount-box exchange-amount-total">
              <span class="exchange-amount-label">Total Deposited</span>
              <span class="exchange-amount-value">฿<t t-esc="state.amount.toLocaleString()"/></span>
            </div>
            <div class="exchange-amount-box exchange-amount-selected">
              <span class="exchange-amount-label">Selected</span>
              <span class="exchange-amount-value">฿<t t-esc="totalSelected.toLocaleString()"/></span>
            </div>
            <div class="exchange-amount-box exchange-amount-remaining" t-att-class="{ 'zero': amountLeft === 0 }">
              <span class="exchange-amount-label">Remaining</span>
              <span class="exchange-amount-value">฿<t t-esc="amountLeft.toLocaleString()"/></span>
            </div>
          </div>

          <!-- Denomination Grid - Notes Row -->
          <div class="exchange-denom-section">
            <div class="exchange-denom-section-label">
              <i class="fa fa-money"></i>
              <span>Notes / ธนบัตร</span>
            </div>
            <div class="exchange-denom-row">
              <t t-foreach="state.denominations.filter(d => d.value >= 20)" t-as="denom" t-key="denom.value">
                <div t-attf-class="exchange-denom-item {{ denom.qty > 0 ? 'selected' : '' }} {{ !canAdd(denom) and denom.qty === 0 ? 'disabled' : '' }}">
                  <div class="exchange-denom-value">฿<t t-esc="denom.value.toLocaleString()"/></div>
                  <div class="exchange-denom-controls">
                    <button class="exchange-denom-btn exchange-denom-minus"
                            t-att-disabled="denom.qty === 0"
                            t-on-click="() => decrement(denom)">
                      <i class="fa fa-minus"></i>
                    </button>
                    <span class="exchange-denom-qty"><t t-esc="denom.qty"/></span>
                    <button class="exchange-denom-btn exchange-denom-plus"
                            t-att-disabled="!canAdd(denom)"
                            t-on-click="() => increment(denom)">
                      <i class="fa fa-plus"></i>
                    </button>
                  </div>
                  <div class="exchange-denom-subtotal" t-if="denom.qty > 0">
                    = ฿<t t-esc="(denom.value * denom.qty).toLocaleString()"/>
                  </div>
                </div>
              </t>
            </div>
          </div>

          <!-- Denomination Grid - Coins Row -->
          <div class="exchange-denom-section">
            <div class="exchange-denom-section-label">
              <i class="fa fa-circle"></i>
              <span>Coins / เหรียญ</span>
            </div>
            <div class="exchange-denom-row exchange-denom-row-coins">
              <t t-foreach="state.denominations.filter(d => d.value &lt; 20)" t-as="denom" t-key="denom.value">
                <div t-attf-class="exchange-denom-item exchange-denom-coin {{ denom.qty > 0 ? 'selected' : '' }} {{ !canAdd(denom) and denom.qty === 0 ? 'disabled' : '' }}">
                  <div class="exchange-denom-value">฿<t t-esc="denom.value"/></div>
                  <div class="exchange-denom-controls">
                    <button class="exchange-denom-btn exchange-denom-minus"
                            t-att-disabled="denom.qty === 0"
                            t-on-click="() => decrement(denom)">
                      <i class="fa fa-minus"></i>
                    </button>
                    <span class="exchange-denom-qty"><t t-esc="denom.qty"/></span>
                    <button class="exchange-denom-btn exchange-denom-plus"
                            t-att-disabled="!canAdd(denom)"
                            t-on-click="() => increment(denom)">
                      <i class="fa fa-plus"></i>
                    </button>
                  </div>
                  <div class="exchange-denom-subtotal" t-if="denom.qty > 0">
                    = ฿<t t-esc="(denom.value * denom.qty).toLocaleString()"/>
                  </div>
                </div>
              </t>
            </div>
          </div>

          <!-- Actions -->
          <div class="exchange-denom-actions">
            <button class="exchange-btn exchange-btn-confirm"
                    t-att-disabled="amountLeft !== 0 || state.busy"
                    t-on-click="onConfirmDenominations">
              <i class="fa fa-check me-2"></i>
              <span>Dispense Cash</span>
            </button>
            <button class="exchange-btn exchange-btn-cancel"
                    t-att-disabled="state.busy"
                    t-on-click="onHome">
              <i class="fa fa-times me-2"></i>
              <span>Cancel</span>
            </button>
          </div>

          <!-- Hint -->
          <div class="exchange-hint" t-if="amountLeft !== 0">
            <i class="fa fa-info-circle"></i>
            <span>Select denominations totaling exactly ฿<t t-esc="state.amount.toLocaleString()"/> to proceed</span>
          </div>
        </div>
      </div>
    </t>

    <!-- Step 3: Summary -->
    <t t-if="state.step === 'summary'">
      <div class="exchange-summary-container">
        <div class="exchange-summary-card">
          <!-- Success Icon -->
          <div class="exchange-summary-icon">
            <i class="fa fa-check-circle"></i>
          </div>

          <h2 class="exchange-summary-title">Exchange Complete!</h2>
          <p class="exchange-summary-subtitle">กรุณารับเงินที่ช่องจ่ายเงิน</p>

          <!-- Dispensed Amount -->
          <div class="exchange-summary-amount">
            <span class="exchange-summary-currency">฿</span>
            <span class="exchange-summary-value"><t t-esc="totalSelected.toLocaleString()"/></span>
          </div>

          <!-- Breakdown -->
          <div class="exchange-summary-breakdown">
            <t t-foreach="state.denominations" t-as="denom" t-key="denom.value">
              <t t-if="denom.qty > 0">
                <div class="exchange-summary-row">
                  <span class="exchange-summary-denom">฿<t t-esc="denom.value.toLocaleString()"/></span>
                  <span class="exchange-summary-qty">× <t t-esc="denom.qty"/></span>
                  <span class="exchange-summary-subtotal">= ฿<t t-esc="(denom.value * denom.qty).toLocaleString()"/></span>
                </div>
              </t>
            </t>
          </div>

          <!-- Done Button -->
          <button class="exchange-btn exchange-btn-done" t-on-click="onHome">
            <i class="fa fa-home me-2"></i>
            <span>Done</span>
          </button>
        </div>
      </div>
    </t>

  </div>
</t>

</templates>