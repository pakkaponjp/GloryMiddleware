<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve" xmlns:t="http://odoo.com/owl">

<t t-name="gas_station_cash.ExchangeCashScreen" owl="1">
  <div class="o_exchange_cash_screen">

    <!-- Step 1: Live Cash-In (using LiveCashInScreen component) -->
    <t t-if="state.step === 'counting'">
      <LiveCashInScreen
          liveAmount="state.liveAmount"
          busy="state.busy"
          onDone.bind="_onCashInDone"
          onCancel.bind="_onCashInCancel"
          onApiError.bind="_onCashInError"
          onStatusUpdate="props.onStatusUpdate"
      />
    </t>

    <!-- Step 2: Denomination Selection -->
    <t t-if="state.step === 'denominations'">
      <div class="exchange-screen-wrap">

        <!-- Top Bar: Title + Amount Summary -->
        <div class="exchange-top-bar">
          <div class="exchange-top-title">
            <i class="fa fa-exchange"></i>
            <span>Exchange Notes &amp; Coins</span>
          </div>
          <div class="exchange-top-summary">
            <div class="exchange-summary-pill">
              <span class="esp-label">Deposited</span>
              <span class="esp-value">฿<t t-esc="state.amount.toLocaleString()"/></span>
            </div>
            <div class="exchange-summary-pill esp-selected">
              <span class="esp-label">Selected</span>
              <span class="esp-value">฿<t t-esc="totalSelected.toLocaleString()"/></span>
            </div>
            <div t-att-class="'exchange-summary-pill' + (amountLeft === 0 ? ' esp-done' : ' esp-remaining')">
              <span class="esp-label">Remaining</span>
              <span class="esp-value">฿<t t-esc="amountLeft.toLocaleString()"/></span>
            </div>
          </div>
        </div>

        <!-- Main Content -->
        <div class="exchange-main">

          <!-- NOTES SECTION -->
          <div class="exchange-section-label">
            <i class="fa fa-money"></i> NOTES / ธนบัตร
          </div>
          <div class="exchange-notes-strip">

            <!--
              Note cards using real Thai Baht banknote images.
              Images located at: /gas_station_cash/static/img/denominations/
              Available: note1000.png, note500.png, note100.png, note50.png
              ฿20 uses a styled CSS fallback (no image provided).
            -->

            <!-- ฿1,000 -->
            <t t-set="d1000" t-value="state.denominations.find(d => d.value === 1000)"/>
            <div t-att-class="'note-img-card' + (d1000.qty > 0 ? ' nic-active' : '') + (!canAdd(d1000) and d1000.qty === 0 ? ' nic-disabled' : '')">
              <div class="nic-denom-label">1,000 THB</div>
              <div class="nic-image-wrap">
                <img src="/gas_station_cash/static/img/denominations/note1000.png" alt="฿1,000" class="nic-img"/>
                <div class="nic-qty-badge" t-if="d1000.qty > 0">× <t t-esc="d1000.qty"/></div>
              </div>
              <div class="nic-subtotal">
                <t t-if="d1000.qty > 0">฿<t t-esc="(1000 * d1000.qty).toLocaleString()"/></t>
                <t t-else="">—</t>
              </div>
              <div class="nic-controls">
                <button class="denom-btn denom-minus" t-att-disabled="d1000.qty === 0" t-on-click="() => decrement(d1000)"><i class="fa fa-minus"/></button>
                <span class="denom-qty"><t t-esc="d1000.qty"/></span>
                <button class="denom-btn denom-plus" t-att-disabled="!canAdd(d1000)" t-on-click="() => increment(d1000)"><i class="fa fa-plus"/></button>
              </div>
            </div>

            <!-- ฿500 -->
            <t t-set="d500" t-value="state.denominations.find(d => d.value === 500)"/>
            <div t-att-class="'note-img-card' + (d500.qty > 0 ? ' nic-active' : '') + (!canAdd(d500) and d500.qty === 0 ? ' nic-disabled' : '')">
              <div class="nic-denom-label">500 THB</div>
              <div class="nic-image-wrap">
                <img src="/gas_station_cash/static/img/denominations/note500.png" alt="฿500" class="nic-img"/>
                <div class="nic-qty-badge" t-if="d500.qty > 0">× <t t-esc="d500.qty"/></div>
              </div>
              <div class="nic-subtotal">
                <t t-if="d500.qty > 0">฿<t t-esc="(500 * d500.qty).toLocaleString()"/></t>
                <t t-else="">—</t>
              </div>
              <div class="nic-controls">
                <button class="denom-btn denom-minus" t-att-disabled="d500.qty === 0" t-on-click="() => decrement(d500)"><i class="fa fa-minus"/></button>
                <span class="denom-qty"><t t-esc="d500.qty"/></span>
                <button class="denom-btn denom-plus" t-att-disabled="!canAdd(d500)" t-on-click="() => increment(d500)"><i class="fa fa-plus"/></button>
              </div>
            </div>

            <!-- ฿100 -->
            <t t-set="d100" t-value="state.denominations.find(d => d.value === 100)"/>
            <div t-att-class="'note-img-card' + (d100.qty > 0 ? ' nic-active' : '') + (!canAdd(d100) and d100.qty === 0 ? ' nic-disabled' : '')">
              <div class="nic-denom-label">100 THB</div>
              <div class="nic-image-wrap">
                <img src="/gas_station_cash/static/img/denominations/note100.png" alt="฿100" class="nic-img"/>
                <div class="nic-qty-badge" t-if="d100.qty > 0">× <t t-esc="d100.qty"/></div>
              </div>
              <div class="nic-subtotal">
                <t t-if="d100.qty > 0">฿<t t-esc="(100 * d100.qty).toLocaleString()"/></t>
                <t t-else="">—</t>
              </div>
              <div class="nic-controls">
                <button class="denom-btn denom-minus" t-att-disabled="d100.qty === 0" t-on-click="() => decrement(d100)"><i class="fa fa-minus"/></button>
                <span class="denom-qty"><t t-esc="d100.qty"/></span>
                <button class="denom-btn denom-plus" t-att-disabled="!canAdd(d100)" t-on-click="() => increment(d100)"><i class="fa fa-plus"/></button>
              </div>
            </div>

            <!-- ฿50 -->
            <t t-set="d50" t-value="state.denominations.find(d => d.value === 50)"/>
            <div t-att-class="'note-img-card' + (d50.qty > 0 ? ' nic-active' : '') + (!canAdd(d50) and d50.qty === 0 ? ' nic-disabled' : '')">
              <div class="nic-denom-label">50 THB</div>
              <div class="nic-image-wrap">
                <img src="/gas_station_cash/static/img/denominations/note50.png" alt="฿50" class="nic-img"/>
                <div class="nic-qty-badge" t-if="d50.qty > 0">× <t t-esc="d50.qty"/></div>
              </div>
              <div class="nic-subtotal">
                <t t-if="d50.qty > 0">฿<t t-esc="(50 * d50.qty).toLocaleString()"/></t>
                <t t-else="">—</t>
              </div>
              <div class="nic-controls">
                <button class="denom-btn denom-minus" t-att-disabled="d50.qty === 0" t-on-click="() => decrement(d50)"><i class="fa fa-minus"/></button>
                <span class="denom-qty"><t t-esc="d50.qty"/></span>
                <button class="denom-btn denom-plus" t-att-disabled="!canAdd(d50)" t-on-click="() => increment(d50)"><i class="fa fa-plus"/></button>
              </div>
            </div>

            <!-- ฿20 -->
            <t t-set="d20" t-value="state.denominations.find(d => d.value === 20)"/>
            <div t-att-class="'note-img-card' + (d20.qty > 0 ? ' nic-active' : '') + (!canAdd(d20) and d20.qty === 0 ? ' nic-disabled' : '')">
              <div class="nic-denom-label">20 THB</div>
              <div class="nic-image-wrap">
                <img src="/gas_station_cash/static/img/denominations/note20.png" alt="฿20" class="nic-img"/>
                <div class="nic-qty-badge" t-if="d20.qty > 0">× <t t-esc="d20.qty"/></div>
              </div>
              <div class="nic-subtotal">
                <t t-if="d20.qty > 0">฿<t t-esc="(20 * d20.qty).toLocaleString()"/></t>
                <t t-else="">—</t>
              </div>
              <div class="nic-controls">
                <button class="denom-btn denom-minus" t-att-disabled="d20.qty === 0" t-on-click="() => decrement(d20)"><i class="fa fa-minus"/></button>
                <span class="denom-qty"><t t-esc="d20.qty"/></span>
                <button class="denom-btn denom-plus" t-att-disabled="!canAdd(d20)" t-on-click="() => increment(d20)"><i class="fa fa-plus"/></button>
              </div>
            </div>

          </div>

          <!-- COINS SECTION -->
          <div class="exchange-section-label" style="margin-top: 1rem;">
            <i class="fa fa-circle"></i> COINS / เหรียญ
          </div>
          <div class="exchange-coins-strip">

            <!--
              Coin cards using real Thai Baht coin images.
              Available: coin10.jpg, coin5.jpg, coin2.jpg, coin1.jpg
            -->

            <!-- ฿10 -->
            <t t-set="c10" t-value="state.denominations.find(d => d.value === 10)"/>
            <div t-att-class="'coin-img-card' + (c10.qty > 0 ? ' cic-active' : '') + (!canAdd(c10) and c10.qty === 0 ? ' cic-disabled' : '')">
              <div class="cic-denom-label">10 THB</div>
              <div class="cic-image-wrap">
                <img src="/gas_station_cash/static/img/denominations/coin10.jpg" alt="฿10" class="cic-img"/>
                <div class="cic-qty-badge" t-if="c10.qty > 0">× <t t-esc="c10.qty"/></div>
              </div>
              <div class="cic-subtotal">
                <t t-if="c10.qty > 0">฿<t t-esc="(10 * c10.qty).toLocaleString()"/></t>
                <t t-else="">—</t>
              </div>
              <div class="nic-controls">
                <button class="denom-btn denom-minus" t-att-disabled="c10.qty === 0" t-on-click="() => decrement(c10)"><i class="fa fa-minus"/></button>
                <span class="denom-qty"><t t-esc="c10.qty"/></span>
                <button class="denom-btn denom-plus" t-att-disabled="!canAdd(c10)" t-on-click="() => increment(c10)"><i class="fa fa-plus"/></button>
              </div>
            </div>

            <!-- ฿5 -->
            <t t-set="c5" t-value="state.denominations.find(d => d.value === 5)"/>
            <div t-att-class="'coin-img-card' + (c5.qty > 0 ? ' cic-active' : '') + (!canAdd(c5) and c5.qty === 0 ? ' cic-disabled' : '')">
              <div class="cic-denom-label">5 THB</div>
              <div class="cic-image-wrap">
                <img src="/gas_station_cash/static/img/denominations/coin5.jpg" alt="฿5" class="cic-img"/>
                <div class="cic-qty-badge" t-if="c5.qty > 0">× <t t-esc="c5.qty"/></div>
              </div>
              <div class="cic-subtotal">
                <t t-if="c5.qty > 0">฿<t t-esc="(5 * c5.qty).toLocaleString()"/></t>
                <t t-else="">—</t>
              </div>
              <div class="nic-controls">
                <button class="denom-btn denom-minus" t-att-disabled="c5.qty === 0" t-on-click="() => decrement(c5)"><i class="fa fa-minus"/></button>
                <span class="denom-qty"><t t-esc="c5.qty"/></span>
                <button class="denom-btn denom-plus" t-att-disabled="!canAdd(c5)" t-on-click="() => increment(c5)"><i class="fa fa-plus"/></button>
              </div>
            </div>

            <!-- ฿2 -->
            <t t-set="c2" t-value="state.denominations.find(d => d.value === 2)"/>
            <div t-att-class="'coin-img-card' + (c2.qty > 0 ? ' cic-active' : '') + (!canAdd(c2) and c2.qty === 0 ? ' cic-disabled' : '')">
              <div class="cic-denom-label">2 THB</div>
              <div class="cic-image-wrap">
                <img src="/gas_station_cash/static/img/denominations/coin2.jpg" alt="฿2" class="cic-img"/>
                <div class="cic-qty-badge" t-if="c2.qty > 0">× <t t-esc="c2.qty"/></div>
              </div>
              <div class="cic-subtotal">
                <t t-if="c2.qty > 0">฿<t t-esc="(2 * c2.qty).toLocaleString()"/></t>
                <t t-else="">—</t>
              </div>
              <div class="nic-controls">
                <button class="denom-btn denom-minus" t-att-disabled="c2.qty === 0" t-on-click="() => decrement(c2)"><i class="fa fa-minus"/></button>
                <span class="denom-qty"><t t-esc="c2.qty"/></span>
                <button class="denom-btn denom-plus" t-att-disabled="!canAdd(c2)" t-on-click="() => increment(c2)"><i class="fa fa-plus"/></button>
              </div>
            </div>

            <!-- ฿1 -->
            <t t-set="c1" t-value="state.denominations.find(d => d.value === 1)"/>
            <div t-att-class="'coin-img-card' + (c1.qty > 0 ? ' cic-active' : '') + (!canAdd(c1) and c1.qty === 0 ? ' cic-disabled' : '')">
              <div class="cic-denom-label">1 THB</div>
              <div class="cic-image-wrap">
                <img src="/gas_station_cash/static/img/denominations/coin1.jpg" alt="฿1" class="cic-img"/>
                <div class="cic-qty-badge" t-if="c1.qty > 0">× <t t-esc="c1.qty"/></div>
              </div>
              <div class="cic-subtotal">
                <t t-if="c1.qty > 0">฿<t t-esc="(1 * c1.qty).toLocaleString()"/></t>
                <t t-else="">—</t>
              </div>
              <div class="nic-controls">
                <button class="denom-btn denom-minus" t-att-disabled="c1.qty === 0" t-on-click="() => decrement(c1)"><i class="fa fa-minus"/></button>
                <span class="denom-qty"><t t-esc="c1.qty"/></span>
                <button class="denom-btn denom-plus" t-att-disabled="!canAdd(c1)" t-on-click="() => increment(c1)"><i class="fa fa-plus"/></button>
              </div>
            </div>

            <!-- ฿0.50 -->
            <t t-set="c050" t-value="state.denominations.find(d => d.value === 0.5)"/>
            <div t-att-class="'coin-img-card' + (c050.qty > 0 ? ' cic-active' : '') + (!canAdd(c050) and c050.qty === 0 ? ' cic-disabled' : '')">
              <div class="cic-denom-label">0.50 THB</div>
              <div class="cic-image-wrap">
                <img src="/gas_station_cash/static/img/denominations/coin050.jpg" alt="฿0.50" class="cic-img"/>
                <div class="cic-qty-badge" t-if="c050.qty > 0">× <t t-esc="c050.qty"/></div>
              </div>
              <div class="cic-subtotal">
                <t t-if="c050.qty > 0">฿<t t-esc="(0.5 * c050.qty).toFixed(2)"/></t>
                <t t-else="">—</t>
              </div>
              <div class="nic-controls">
                <button class="denom-btn denom-minus" t-att-disabled="c050.qty === 0" t-on-click="() => decrement(c050)"><i class="fa fa-minus"/></button>
                <span class="denom-qty"><t t-esc="c050.qty"/></span>
                <button class="denom-btn denom-plus" t-att-disabled="!canAdd(c050)" t-on-click="() => increment(c050)"><i class="fa fa-plus"/></button>
              </div>
            </div>

            <!-- ฿0.25 -->
            <t t-set="c025" t-value="state.denominations.find(d => d.value === 0.25)"/>
            <div t-att-class="'coin-img-card' + (c025.qty > 0 ? ' cic-active' : '') + (!canAdd(c025) and c025.qty === 0 ? ' cic-disabled' : '')">
              <div class="cic-denom-label">0.25 THB</div>
              <div class="cic-image-wrap">
                <img src="/gas_station_cash/static/img/denominations/coin025.jpg" alt="฿0.25" class="cic-img"/>
                <div class="cic-qty-badge" t-if="c025.qty > 0">× <t t-esc="c025.qty"/></div>
              </div>
              <div class="cic-subtotal">
                <t t-if="c025.qty > 0">฿<t t-esc="(0.25 * c025.qty).toFixed(2)"/></t>
                <t t-else="">—</t>
              </div>
              <div class="nic-controls">
                <button class="denom-btn denom-minus" t-att-disabled="c025.qty === 0" t-on-click="() => decrement(c025)"><i class="fa fa-minus"/></button>
                <span class="denom-qty"><t t-esc="c025.qty"/></span>
                <button class="denom-btn denom-plus" t-att-disabled="!canAdd(c025)" t-on-click="() => increment(c025)"><i class="fa fa-plus"/></button>
              </div>
            </div>

          </div>

          <!-- Bottom Bar: Notification + Hint + Actions -->
          <div class="exchange-bottom-bar">

            <!-- Notification Message -->
            <div t-if="state.message" t-att-class="'exchange-message exchange-message-' + state.message.type">
              <i t-att-class="'fa ' + (state.message.type === 'success' ? 'fa-check-circle' : state.message.type === 'danger' ? 'fa-exclamation-circle' : 'fa-info-circle')"></i>
              <span><t t-esc="state.message.text"/></span>
            </div>

            <!-- Hint when remaining amount is not zero -->
            <div class="exchange-hint" t-if="amountLeft !== 0">
              <i class="fa fa-info-circle"></i>
              <span>Select denominations totaling exactly ฿<t t-esc="state.amount.toLocaleString()"/> to proceed</span>
            </div>

            <!-- Action Buttons -->
            <div class="exchange-actions">
              <button class="exchange-btn exchange-btn-confirm"
                      t-att-disabled="amountLeft !== 0 || state.busy"
                      t-on-click="onConfirmDenominations">
                <i class="fa fa-check me-2"></i>
                Dispense
              </button>
              <button class="exchange-btn exchange-btn-cancel"
                      t-att-disabled="state.busy"
                      t-on-click="onHome">
                Cancel
              </button>
            </div>

          </div>
        </div>
      </div>
    </t>

    <!-- Step 3: Summary (Auto-return to home) -->
    <t t-if="state.step === 'summary'">
      <div class="exchange-summary-container">
        <div class="exchange-summary-card">
          <div class="exchange-summary-icon">
            <i class="fa fa-check-circle"></i>
          </div>
          <h2 class="exchange-summary-title">Exchange Complete!</h2>
          <p class="exchange-summary-subtitle">กรุณารับเงินที่ช่องจ่ายเงิน</p>
          <div class="exchange-summary-amount">
            <span class="exchange-summary-currency">฿</span>
            <span class="exchange-summary-value"><t t-esc="totalSelected.toLocaleString()"/></span>
          </div>
          <div class="exchange-summary-breakdown">
            <t t-foreach="state.denominations" t-as="denom" t-key="denom.value">
              <t t-if="denom.qty > 0">
                <div class="exchange-summary-row">
                  <span class="exchange-summary-denom">฿<t t-esc="denom.value.toLocaleString()"/></span>
                  <span class="exchange-summary-qty">× <t t-esc="denom.qty"/></span>
                  <span class="exchange-summary-subtotal">= ฿<t t-esc="(denom.value * denom.qty).toLocaleString()"/></span>
                </div>
              </t>
            </t>
          </div>
          <div class="exchange-summary-notice">
            <i class="fa fa-clock-o"></i>
            <span>Returning to menu in <t t-esc="state.countdown"/> seconds...</span>
          </div>
        </div>
      </div>
    </t>

  </div>
</t>

</templates>